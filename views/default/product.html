{{ extend 'layout.html' }}
{{ include 'catalog.html' }}


<h1>{{= product.name }}</h1>

<img src="{{= URL(r=request, f='show', args=(product.large_image if product.large_image else product.small_image)) }}" height="200px"/>

<p>{{= product.description }}</p>

{{= product_form }}
{{ # XXX change to use FORM? }}
<form action="{{= URL(r=request, f='add_to_cart', args=product.id) }}" method="post" enctype="multipart/form-data">
{{ if options: }}
    <h3>Options</h3>
    <table>
    {{ for option in options: }}
        <tr>
            <td><input name="option" value="{{= option.id }}" type="checkbox" onchange="update_price(this, {{= option.price }})"/></td>
            <td>{{= option.description }}</td>
            <td> (+<b>${{= '%.2f' % option.price }}</b>)</td>
        </tr>
    {{ pass }}
    </table>
    <br/>
{{ pass }}

{{ if product.old_price: }}
<b>was ${{= '%.2f' % float(product.old_price) }}</b>
{{ pass }}
<h2>$<span id="total_price">{{= '%.2f' % float(product.price) }}</span></h2>
<input type="submit" value="Add to cart"/>
{{ if product.id in session.cart: }}
    ({{= session.cart[product.id] }} already in cart)
{{ pass }}
</form>

{{ if product.allow_rating and product.rating > 0: }}
        {{= '%.1f' % product.rating }}/5.0 rating,
    {{ pass }}
    {{ if product.show_quantity: }}
        {{ if product.quantity_in_stock < 1: }}
            low stock
        {{ else: }}
            {{= product.quantity_in_stock }} in stock
        {{ pass }}        
    {{ pass }}
{{ pass }}    

<br/>
<br/>
{{ if suggested: }}
<h2>You may also be interested in:</h2>
    {{ show(suggested) }}
{{ pass }}


{{ if product.allow_rating: }}
<br/>
    {{ if comments: }}
<h2>Visitors' comments</h2>
<p><ul>
        {{ for comment in comments: }}
    <li>{{= comment.author }} says <i>"{{= comment.body }}"</i></li>
        {{ pass }}
</ul>
</p>
    {{ pass }}
    {{= comment_form }}
{{ pass }}



<script type="text/javascript">
    var total_price = {{= product.price }};
        
    function update_price(e, option_price) {
        if($(e).is(':checked')) total_price += option_price;
        else total_price -= option_price;
        $("#total_price").text('$' + total_price);
    }
</script>